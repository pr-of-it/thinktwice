<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">

    <title></title>

    <!--Стили макета-->
    <link rel="stylesheet" type="text/css" href="CSS/common.css">
    <link rel="stylesheet" type="text/css" href="CSS/header.css">
    <link rel="stylesheet" type="text/css" href="CSS/footer.css">
    <link rel="stylesheet" type="text/css" href="CSS/ui.css">
    <!--Стили страниц-->
    <link rel="stylesheet" type="text/css" href="CSS/auth.css">
    <link rel="stylesheet" type="text/css" href="CSS/dashboard.css">
    <link rel="stylesheet" type="text/css" href="CSS/users.css">

    <!--Видео-->

    <!--Тестовые данные-->
    <script type="text/javascript" src="Resources/JSON/current-user-info.js"></script>
    <script type="text/javascript" src="Resources/JSON/user-groups.js"></script>
    <script type="text/javascript" src="Resources/JSON/users-data.js"></script>
    <!--jQuery-->
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

    <!--Основной скрипт-->
    <script type="text/javascript">
        var activePage = "dashboard";
        var usersRowCount = 1;
        var isAuthorized = false;

        var initialization = {
            dashboard: initDashboardPage,
            users: initUsersPage
        };

        function setActivePage (pageName) {
            if (activePage == pageName) {
                return;
            }

            $("#" + activePage).css("display", "none");

            var p = $("#" + pageName);
            p.css("display", "inline-block");

            activePage = pageName;

            initialization[pageName]();
        }

        function applyAuth() {
            $("#user-auth").css("display", "none");
            $("#user-info").css("display", "block");

            //загрузка информации о пользователе
            $("#user-avatar").append("<img src='Resources/Img/user-avatar.png'>");
            $("#user-name").append("<span>" + currentUserData.firstName + " " + currentUserData.lastName+ "</span>");
            $("#user-money").append("<span>" + currentUserData.money.count + " " + currentUserData.money.units + "</span>");
            $("#association-count").append("Всего (" + currentUserData.association.length + ")");

            isAuthorized = true;

            //активировать страницу
            var a =  $("#" + activePage);
            a.css("display", "inline-block");
            initialization[activePage]();
        }

        function denyAuth() {
            //очистка данных
            $("#user-avatar").empty();
            $("#user-name").empty();
            $("#user-money").empty();
            $("#association-count").empty();

            $("#user-auth").css("display", "block");
            $("#user-info").css("display", "none");

            isAuthorized = false;

            //активировать страницу
            var a =  $("#" + activePage);
            a.css("display", "inline-block");
            initialization[activePage]();
        }

        function authorization() {
            var p = $(".auth-overlay");
            p.css("display", "inline-block");
        }

        function init() {
            var p = $(".auth-overlay");

            p.click(function(event) {
                var e = event || window.event;
                if (e.target == this) {
                    p.css("display", "none");
                    denyAuth();
                }
            });

            var b = $("#signin-button");

            b.click(function (event) {
                var e = event || window.event;
                if (e.target == this) {
                    p.css("display", "none");
                    applyAuth();
                }
            });
        }

        function toRegistration() {
            $("#signin").css("display", "none");
            $("#registration").css("display", "block");
        }

        function toSignin() {
            $("#registration").css("display", "none");
            $("#signin").css("display", "block");
        }

        function closeVideo() {
            $("#video").css("display", "none");
            $(".dashboard-block").first().css("margin-left", "180px");
        }

        function getActualContentHeight() {
            return document.getElementsByClassName('block-header')[0].clientHeight +
                    document.getElementsByClassName('block-bottom')[0].clientHeight;
        }

        function initDashboardPage() {
            var w = $("#video")[0].clientWidth;

            var bs = $(".dashboard-block");

            if (isAuthorized) {
                bs.css("display", "block");
            } else {
                bs.css("display", "none");
            }

            for (var i = 0; i < bs.length; i++) {
                w += bs[i].clientWidth;
            }

            var pc = $("#dashboard").find("> .page > .page-content");
            pc.css("width", w + 180);
        }

        function initUsersPage() {
            //актуальная высота
            var h = document.height - getActualContentHeight() -
                    document.getElementsByClassName('users-caption-block')[0].clientHeight - 84;
            //количество строк
            usersRowCount = Math.floor(h/220);

            //количество столбцов
            var acols = 3;
            if (currentUserData.association.length / usersRowCount < 3) {
                acols = 2;
            }

            var u = 0;

            //заполнить подписанными
            var at = $("#user-association-body");
            at.empty();

            for (var r = 0; r < usersRowCount; r++) {
                var tr = $("<tr></tr>");
                at.append(tr);

                for (var c = 0; c < acols; c++) {
                    var id = currentUserData.association[u];

                    if (id == null) {
                        continue;
                    }

                    var cell = $("<td></td>");
                    tr.append(cell);
                    createUserWidget(id, cell);
                    u++;
                }
            }
            //заполнить остальные

        }

        function addUserGroup (groupName, peopleCount) {
            //создать
            var g = $("#groups");

            var b = $("<div class='users-group-block'></div>");
            g.append(b);

            var c = $("<div class='users-group-block-caption'></div>");
            c.append("<span class='users-group-block-caption-text'>" + groupName + "</span>");
            c.append("<span class='users-group-block-caption-count'>Всего (" + peopleCount + ")</span>");

            b.append(c);

            var t = $("<table><tbody></tbody></table>");
            b.append(t);

            return t;
        }

        function fillUserGroup (groupName, t) {
            var u = 0;

            for (var i = 0; i < usersRowCount; i++) {
                var tr = $("<tr></tr>");
                t.append(tr);

                for (var j = 0; j < 3; j++) {
                    u++;
                }
            }
        }

        function createUserWidget(id, cell) {
            var data = usersData['id' + id];

            if (data == null) {
                return;
            }

            var w = $("<div class='users-widget'></div>");
            cell.append(w);

            var avatar = $("<div style='text-align: center;'><div class='ui-avatar' style='float: none;'></div></div>");
            w.append(avatar);

            var name = $("<div class='users-name-block'>" + data.firstName + " " + data.lastName + "</div>");
            w.append(name);

            if (data.group == "Expert") {
                w.append($("<div class='users-desc-expert-block'>" + data.position + "</div>"));
                w.append($("<div class='users-desc-expert-block'>" + data.cost + "</div>"));
            } else if (data.group == "People") {
                w.append($("<div class='users-desc-block'>" + data.company + "<br>" + data.position + "</div>"));
            }
        }

        $(window).load(function () {
            init();
            authorization();
        });
        //$(window).resize();
    </script>
</head>
<body>
<!--Авторизация-->
<div class="auth-overlay">
    <div class="auth-block">
        <div class="auth-block-caption">
            <span>Вход на сайт</span>
        </div>
        <div class="auth-block-form">
            <div class="auth-block-form-content">
                <div id="signin" class="auth-block-form-content-block">
                    <table>
                        <tbody>
                            <tr>
                                <td><label for="signin-email">E-mail</label></td>
                                <td><input type="text" id="signin-email" class="auth-block-form-content-block-input" /></td>
                            </tr>
                            <tr>
                                <td><label for="signin-pass">Пароль</label></td>
                                <td><input type="password" id="signin-pass" class="auth-block-form-content-block-input" value="" /></td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="auth-block-form-content-buttons">
                        <div id="signin-button" class="auth-block-form-content-buttons-main">
                            <span>войти</span>
                        </div>
                        <div class="auth-block-form-content-buttons-toggle">
                            <a href="#" onclick="toRegistration()">Зарегистрироваться</a>
                        </div>
                    </div>
                </div>
                <div id="registration" class="auth-block-form-content-block" style="display: none">
                    <table>
                        <tbody>
                            <tr>
                                <td><label for="registr-email">E-mail</label></td>
                                <td><input type="text" id="registr-email" class="auth-block-form-content-block-input" /></td>
                            </tr>
                            <tr>
                                <td><label for="registr-pass">Пароль</label></td>
                                <td><input type="password" id="registr-pass" class="auth-block-form-content-block-input" value="" /></td>
                            </tr>
                            <tr>
                                <td><label for="registr-replay-pass">Еще раз</label></td>
                                <td><input type="password" id="registr-replay-pass" class="auth-block-form-content-block-input" value="" /></td>
                            </tr>
                            <tr>
                                <td><label for="registr-login">Логин</label></td>
                                <td><input type="text" id="registr-login" class="auth-block-form-content-block-input" /></td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="auth-block-form-content-buttons">
                        <div class="auth-block-form-content-buttons-main">
                            <span>зарегистрироваться</span>
                        </div>
                        <div class="auth-block-form-content-buttons-toggle">
                            <a href="#" onclick="toSignin()">Уже есть аккаунт</a>
                        </div>
                    </div>
                </div>
                <div class="auth-block-form-content-block">

                </div>
            </div>
            <div class="auth-block-footer">
                <p>Авторизуйтесь или регистрируясь, вы автоматически соглашаетесь с <a href="#">офертой пользователя</a></p>
            </div>
        </div>
    </div>
</div>
<!--Тень-->

<!--Макет-->
<div class="base-block">
    <div class="block-top">
        <div class="block-header">
            <div class="block-header-logo">
                <div class="block-header-logo-icon">
                    <table>
                        <tbody onclick="setActivePage('dashboard')">
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td colspan="2"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="block-header-logo-image">
                    <img src="Resources/Img/header-logo.png">
                </div>
            </div>
            <div id="user-info" class="block-header-user">
                <div id="user-avatar" class="ui-avatar"></div>
                <div id="user-name" class="block-header-user-text block-header-user-name"></div>
                <div id="user-money" class="block-header-user-text block-header-user-money"></div>
            </div>
            <div id="user-auth" class="block-header-user" style="display: none">
                <div class="block-header-user-auth" onclick="authorization()">
                    <span>войти</span>
                </div>
            </div>
        </div>
        <div class="block-content">
            <div class="block-content-wrapper">
                <!----------------------------------------------------------------------------------------------------->
                <!--Лента-->

                <!----------------------------------------------------------------------------------------------------->
                <!--Доска-->
                <div id="dashboard" class="hidden-block">
                    <div class="page">
                        <div class="page-content" style="width: 2700px;">
                            <div id="video" class="dashboard-video">
                                <div class="ui-close-button" style="left: 796px; top: 96px" onclick="closeVideo()">
                                    <div class="ui-close-button-one"></div>
                                    <div class="ui-close-button-two"></div>
                                </div>
                                <div class="dashboard-video-block">
                                    <div class="dashboard-caption">Начало</div>
                                    <div style="margin-right: 40px; height: 360px; width: 600px; background: #ccc">

                                    </div>
                                    <div class="dashboard-video-text">
                                        Рассказываю про то как быстро заработать миллион на бирже, многоходовкие, уловки, трюки и приемы — это ко мне.
                                        В основном могу по вечерам, но бывают просветления и днями.
                                        В общем, что я вам все рассказываю? Посмотрите видео, и узнайте.
                                    </div>
                                </div>
                            </div>
                            <div class="dashboard-block">
                                <div class="dashboard-caption">Главное</div>
                                <table>
                                    <tbody>
                                        <tr>
                                            <td class="dashboard-block-small-cell">
                                                <div class="dashboard-widget" style="background: #FAAD21" onclick="setActivePage('users')">
                                                    <img src="Resources/Img/users-panel.png">
                                                    <span>Пользователи</span>
                                                </div>
                                            </td>
                                            <td class="dashboard-block-small-cell">
                                                <div class="dashboard-widget" style="background: #ED6D60">
                                                    <img src="Resources/Img/newsline-panel.png">
                                                    <span>Лента</span>
                                                </div>
                                            </td>
                                            <td class="dashboard-block-big-cell">
                                                <div class="dashboard-widget" style="background: #30767E">
                                                    <img src="Resources/Img/market.png">
                                                    <span>Фондовый рынок</span>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" class="dashboard-block-big-cell">
                                                <div class="dashboard-widget" style="background: #30767E">
                                                    <img src="Resources/Img/alt-inv.png">
                                                    <span>Альтернативыне инвестиции</span>
                                                </div>
                                            </td>
                                            <td class="dashboard-block-big-cell">
                                                <div class="dashboard-widget" style="background: #30767E">
                                                    <img src="Resources/Img/house.png">
                                                    <span>Недвижимость</span>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" class="dashboard-block-big-cell">
                                                <div class="dashboard-widget" style="background: #30767E">
                                                    <img src="Resources/Img/coll-inv.png">
                                                    <span>Коллективыне инвестиции</span>
                                                </div>
                                            </td>
                                            <td class="dashboard-block-big-cell">
                                                <div class="dashboard-widget" style="background: #30767E">
                                                    <img src="Resources/Img/bisness.png">
                                                    <span>Бизнес</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!----------------------------------------------------------------------------------------------------->
                <!--Пользователи-->
                <div id="users" class="hidden-block">
                    <div class="users-caption-block">
                        <div class="users-caption-block-text">Пользователи</div>
                        <div class="users-caption-block-filter">
                            <label for="user-filter">Все</label>
                            <input type="checkbox" id="user-filter" class="ui-toggle" />
                            <span>Только эксперты</span>
                        </div>
                    </div>
                    <div class="page">
                        <div class="page-content" style="width: 2700px">
                            <div id="groups" class="users-page-content">
                                <div id="user-association" class="users-group-block">
                                    <div class="users-group-block-caption">
                                        <span class="users-group-block-caption-text">Я подписался</span>
                                        <span id="association-count" class="users-group-block-caption-count"></span>
                                    </div>
                                    <table>
                                        <tbody id="user-association-body">

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!----------------------------------------------------------------------------------------------------->
                <!--Личный кабинет-->

                <!----------------------------------------------------------------------------------------------------->
                <!--Окно эксперта-->

                <!----------------------------------------------------------------------------------------------------->
            </div>
        </div>
    </div>
    <div class="block-bottom">
        <div class="block-footer">
            <span><a href="#">Пользовательское соглашение</a></span>
            <span><a href="#">Контакты</a></span>
            <span style="padding-right: 44px"><a href="#">Обратная связь</a></span>
            <span><img src="Resources/Img/master-card.png"></span>
            <span style="padding-right: 44px"><img src="Resources/Img/visa.png"></span>
            <span><img src="Resources/Img/twitter.png"></span>
            <span><img src="Resources/Img/facebook.png"></span>
        </div>
    </div>
</div>
</body>
</html>